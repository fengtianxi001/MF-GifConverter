import{e as F,c as A,k as v,p as x,n as c,v as m,m as p,F as D,P,$ as u,z as h,E as W,M as S,N as U,l as C,y as w,r as y,a as H,O as N,o as E,Y as z,W as K,X as b}from"./@vue-Bl_1ggUi.js";import{S as V,T as O,e as R,B as _,b as L,F as j,A as X,f as Y,I as q,c as G}from"./@arco-design-BGb1B8nU.js";import{g as J}from"./gifshot-9uRgnMzp.js";import{m as M,a as $}from"./lodash-es-B16_zbcl.js";import{_ as Q}from"./index-CDzCvF7C.js";const Z={class:"base-table"},ee={class:"base-table-operates"},te={style:{color:"#2d5cf6"}},ne={style:{color:"#2d5cf6"}},se={class:"base-table-empty"},be=F({__name:"BaseTable",props:{columns:{},operates:{},options:{},selected:{},data:{}},emits:["update:selected"],setup(t,{emit:n}){const e=t,a=n,r=A(()=>!e.data||e.data.length<=0),l=A({get:()=>e.selected,set:i=>a("update:selected",i)});return(i,s)=>(v(),x("div",Z,[c("div",ee,[m(u(V),null,{default:p(()=>[(v(!0),x(D,null,P(i.operates,g=>(v(),C(u(_),W({size:"small",ref_for:!0},{...g}),{default:p(()=>[w(h(g.text),1)]),_:2},1040))),256))]),_:1}),m(u(V),{style:{color:"rgb(var(--gray-10))"}},{default:p(()=>[s[1]||(s[1]=c("span",null,"共 ",-1)),c("span",te,h(i.data.length),1),s[2]||(s[2]=c("span",null,"条数据",-1)),s[3]||(s[3]=c("span",null,"/",-1)),s[4]||(s[4]=c("span",null,"已选择 ",-1)),c("span",ne,h(l.value.length),1),s[5]||(s[5]=c("span",null,"条",-1))]),_:1})]),m(u(O),W({class:"base-table-pro",size:"small","row-key":"id",selectedKeys:l.value,"onUpdate:selectedKeys":s[0]||(s[0]=g=>l.value=g),columns:i.columns,data:i.data,stripe:!0,pagination:!1,hoverable:!1,draggable:{type:"handle",width:40},bordered:{wrapper:!0,cell:!0,headerCell:!0,bodyCell:!0}},{...i.options}),null,16,["selectedKeys","columns","data"]),S(c("div",se,[m(u(R),{class:"empty-icon"}),s[6]||(s[6]=c("div",{class:"empty-text"},"暂无数据",-1))],512),[[U,r.value]])]))}});function oe(t,n){const e=y("Pending"),a=y("0%"),r=y(""),l=y(1),i=[],s=H({gifWidth:500,gifHeight:500,numWorkers:10}),g=M(n.map(o=>o.dpi.width)),k=M(n.map(o=>o.dpi.height));l.value=g/k,l.value>1?(s.gifWidth=500,s.gifHeight=Math.floor(500/l.value)):(s.gifWidth=Math.floor(500*l.value),s.gifHeight=500);const f={gifWidth:{name:"gifWidth",component:"InputNumber",label:"宽度",unit:"像素",desc:"动画的期望宽度",props:{min:1,onChange:o=>{const d=o/l.value;s.gifHeight=Math.round(d)},inputAttrs:{style:{textAlign:"right"}}}},gifHeight:{name:"gifHeight",component:"InputNumber",label:"长度",unit:"像素",desc:"动图的期望高度",props:{min:1,onChange:o=>{const d=o/l.value;s.gifWidth=Math.round(d)},inputAttrs:{style:{textAlign:"right"}}}},frameDuration:{name:"frameDuration",component:"InputNumber",label:"每帧停留时间",unit:"秒",desc:"停留在每张图片上的时间",props:{min:0,step:.1,inputAttrs:{style:{textAlign:"right"}}}},numWorkers:{name:"numWorkers",component:"InputNumber",label:"WebWorkers数量",unit:"个",desc:"用于处理动画帧的Workers数量",props:{inputAttrs:{style:{textAlign:"right"}}}},numFrames:{name:"numFrames",component:"InputNumber",label:"时长",unit:"秒",desc:"用于创建动画GIF的帧数",props:{min:0,max:99,step:.1,inputAttrs:{style:{textAlign:"right"}}}}};if(t==="image")s.images=n.map(o=>o.url),s.frameDuration=.1,i.push(f.gifWidth,f.gifHeight,f.frameDuration,f.numWorkers);else{const o=n[0];s.video=n.map(d=>d.url),s.numFrames=parseInt(o.duration*.86*10+"")/10,f.numFrames.props.max=parseInt(o.duration*.86*10+"")/10,i.push(f.gifWidth,f.gifHeight,f.numFrames,f.numWorkers)}return{config:i,aspect:l,stateCode:e,convertProgress:a,convertResult:r,form:s,onConvert:()=>{e.value="Ongoing",a.value="0%",r.value="";const o={...s};o.frameDuration!==void 0?o.frameDuration=o.frameDuration*10:o.numFrames!==void 0&&(o.numFrames=o.numFrames*10),o.progressCallback=d=>{a.value=(d*100).toFixed(2)+"%"},J.createGIF(o,({image:d,error:T})=>{T?(e.value="Pending",r.value="",a.value="0%",L.error(T)):(e.value="Unsaved",r.value=d,a.value="100%",console.log("image",d))})},onSave:()=>{const o=document.createElement("a");o.download="notitle.gif",o.href=r.value,o.click(),e.value="Saved"}}}const ae={class:"base-gif-form"},re={style:{"font-size":"12px"}},le=F({__name:"BaseGifForm",props:{mode:{},aspect:{},modelValue:{},config:{}},emits:["update:modelValue"],setup(t,{emit:n}){const e=t,a=n,r=A({get:()=>e.modelValue,set:l=>a("update:modelValue",l)});return(l,i)=>(v(),x("div",ae,[m(Y,{model:r.value,"auto-label-width":""},{default:p(()=>[(v(!0),x(D,null,P(l.config,s=>(v(),C(j,{field:s.name,label:s.label},{extra:p(()=>[w(h(s.desc),1)]),default:p(()=>[(v(),C(N(X[s.component]),W({modelValue:r.value[s.name],"onUpdate:modelValue":g=>r.value[s.name]=g,ref_for:!0},{...s.props}),{suffix:p(()=>[c("span",re,h(s.unit),1)]),_:2},1040,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["field","label"]))),256))]),_:1},8,["model"])]))}}),ie={class:"base-gif-preview"},ue=F({__name:"BaseGifPreview",props:{code:{},result:{},percent:{}},setup(t){return(n,e)=>(v(),x("div",ie,[S(c("div",{class:"preview-tips"},h(n.percent),513),[[U,n.code==="Ongoing"]]),m(u(q),{class:"preview-image",width:"100%",height:250,fit:"contain",src:n.result},null,8,["src"])]))}}),de=Q(ue,[["__scopeId","data-v-4537a182"]]),ce=F({__name:"BaseGif",props:{mode:{},sources:{},resolve:{type:Function}},setup(t){const n=t,e=y(!0),{config:a,form:r,aspect:l,stateCode:i,convertProgress:s,convertResult:g,onConvert:k,onSave:f}=oe(n.mode,n.sources),I=()=>{e.value=!1};return E(()=>{k()}),(B,o)=>(v(),C(u(G),{visible:e.value,"onUpdate:visible":o[1]||(o[1]=d=>e.value=d),class:"base-gif",title:"参数配置",width:"850px","unmount-on-close":"",draggable:"",closable:!1,"esc-to-close":!1,"mask-closable":!1},{footer:p(()=>[m(u(_),{onClick:I},{default:p(()=>o[2]||(o[2]=[w("关闭")])),_:1}),m(u(_),{onClick:u(k),type:"primary"},{default:p(()=>o[3]||(o[3]=[w("生成预览")])),_:1},8,["onClick"]),m(u(_),{onClick:u(f),type:"primary"},{default:p(()=>o[4]||(o[4]=[w("保存动图")])),_:1},8,["onClick"])]),default:p(()=>[m(le,{modelValue:u(r),"onUpdate:modelValue":o[0]||(o[0]=d=>z(r)?r.value=d:null),mode:B.mode,aspect:u(l),config:u(a)},null,8,["modelValue","mode","aspect","config"]),m(de,{mode:B.mode,result:u(g),percent:u(s),code:u(i)},null,8,["mode","result","percent","code"])]),_:1},8,["visible"]))}});function ye(t,n){return new Promise(e=>{const a=m(ce,{mode:t,resolve:e,sources:n}),r=document.createElement("div");K(a,r);const l=a.el;document.body.appendChild(l)})}const we={getId(){const t=[],n="0123456789abcdef";for(var e=0;e<36;e++)t[e]=n.substr(Math.floor(Math.random()*16),1);return t[14]="4",t[19]=n.substr(t[19]&3|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")},getSize(t){const n=t.size,e=["Bytes","KB","MB","GB"];let a=0,r=n;for(;r>=1024&&a<e.length-1;)r/=1024,a++;return`${r.toFixed(2)} ${e[a]}`},formatSize(t){const n=["Bytes","KB","MB","GB"];let e=0;for(;t>=1024&&e<n.length-1;)t/=1024,e++;return`${t.toFixed(2)}${n[e]}`},chooser(t){return new Promise(n=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=t,e.click(),e.addEventListener("change",()=>n(Array.from(e.files)),{once:!0}),e.onchange=()=>{}})},urlToU8A(t){const n=t.split(","),e=n[0].split(":")[1],a=window.atob(n[1]),r=a.length,l=new Uint8Array(r);for(let i=0;i<r;++i)l[i]=a.charCodeAt(i);return{data:l,type:e}},urlToFile(t,n="notitled"){const{data:e,type:a}=this.urlToU8A(t);return new File([e],n,{type:a})},urlToBlob(t){const{data:n,type:e}=this.urlToU8A(t);return new Blob([n],{type:e})}};async function xe(t){const n=$(t,r=>b("div",{class:"remove-confirm-line"},$(r,l=>b("span",{class:"remove-confirm-word"},l)))),e=b("div",{class:"remove-confirm-wrap"},n),a=b("div",{style:"margin-bottom:10px"},`共 ${t.length} 条数据，是否移除？`);return await me({content:()=>b("div",{},[a,e]),okText:"移除",cancelText:"取消"})}function me(t){const{title:n,titleAlign:e,content:a,okText:r,cancelText:l}=t;return new Promise(i=>{G.open({simple:!0,title:n||"系统提醒:",titleAlign:e||"start",content:a||"你确定要这么做吗?",alignCenter:!0,okText:r||"确认",width:300,cancelText:l||"取消",modalStyle:{padding:"15px 32px 15px"},onOk:()=>i(!0),onCancel:()=>i(!1)})})}export{we as F,be as _,ye as c,xe as r};
