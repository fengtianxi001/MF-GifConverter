import{e as I,r as w,a as U,o as V,k as S,l as D,m as _,v as p,$ as u,y as h,M as g,N as y,n as m,z as k,W as O,p as T,c as j,Y as L}from"./@vue-Bl_1ggUi.js";import{F as z,r as E,c as W,_ as Y}from"./common-BkWiHJ6U.js";import{V as R,c as H}from"./video-C6uv_EWa.js";import{B as C,c as N,b as P}from"./@arco-design-BGb1B8nU.js";import{_ as M}from"./index-CDzCvF7C.js";import{d as A}from"./dayjs-qC8cuZUE.js";import{r as $}from"./lodash-es-B16_zbcl.js";import"./gifshot-9uRgnMzp.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./b-tween-BtQQsX34.js";import"./number-precision-BW_FzNZC.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./b-validate-CWN02ujJ.js";import"./vue-router-BkE0ne8q.js";/* empty css                    */const F={class:"container"},G={class:"camera-record-tip"},q={class:"tip-second"},J={class:"camera-loading"},K=I({__name:"camera",props:{resolve:{type:Function}},setup(c){const n=c,v=w(!0),a=w(),i=U({interval:0,startTime:0,second:""}),o=w(0);let r=[],l=new MediaStream,s;const t={async onCameraOpen(){var x;l=await navigator.mediaDevices.getUserMedia({video:!0});const d=l.getVideoTracks()[0],{width:e,height:f}=d.getSettings(),B=((x=a.value)==null?void 0:x.clientWidth)*(f/e);a.value.style.height=`${B}px`,a.value.srcObject=l,a.value.controls=!1,a.value.addEventListener("loadedmetadata",()=>{a.value.play(),o.value=1},{once:!0})},onCameraClose(){l.getTracks().forEach(d=>d.stop()),o.value=0},onRecordStart(){a.value.srcObject=l,a.value.controls=!1,a.value.play(),r=[],o.value=2,s=new MediaRecorder(l,{mimeType:"video/mp4"}),s.start(),i.startTime=0;const d=()=>{i.startTime++;const e=String(Math.floor(i.startTime/3600)).padStart(2,"0"),f=String(Math.floor(i.startTime%3600/60)).padStart(2,"0"),b=String(i.startTime%60).padStart(2,"0");i.second=`${e}:${f}:${b}`};d(),i.interval=window.setInterval(d,1e3),s.addEventListener("dataavailable",e=>r.push(e.data)),s.addEventListener("stop",()=>{a.value.srcObject=null,a.value.src=URL.createObjectURL(new Blob(r)),a.value.play(),a.value.controls=!0})},onRecordStop(){s==null||s.stop(),t.onCameraClose(),i.interval&&clearInterval(i.interval),o.value=3},async onRecordRestart(){l=await navigator.mediaDevices.getUserMedia({video:!0}),t.onRecordStart()},onModalClose(){v.value=!1,t.onCameraClose()},onVideoSave(){v.value=!1,n.resolve(new Blob(r))}};return V(()=>{t.onCameraOpen()}),(d,e)=>(S(),D(u(N),{visible:v.value,"onUpdate:visible":e[0]||(e[0]=f=>v.value=f),title:"摄像头录制",width:"650px","unmount-on-close":"",draggable:"","body-style":{padding:"10px"},closable:!1,"esc-to-close":!1,"mask-closable":!1},{footer:_(()=>[p(u(C),{onClick:t.onModalClose},{default:_(()=>e[2]||(e[2]=[h("关闭窗口")])),_:1},8,["onClick"]),g(p(u(C),{type:"primary",onClick:t.onRecordStart},{default:_(()=>e[3]||(e[3]=[h(" 开始录制 ")])),_:1},8,["onClick"]),[[y,o.value===1]]),g(p(u(C),{type:"primary",status:"danger",onClick:t.onRecordStop},{default:_(()=>e[4]||(e[4]=[h(" 结束录制 ")])),_:1},8,["onClick"]),[[y,o.value===2]]),g(p(u(C),{type:"primary",onClick:t.onRecordRestart},{default:_(()=>e[5]||(e[5]=[h(" 重新录制 ")])),_:1},8,["onClick"]),[[y,o.value===3]]),g(p(u(C),{type:"primary",onClick:t.onVideoSave},{default:_(()=>e[6]||(e[6]=[h(" 保存 ")])),_:1},8,["onClick"]),[[y,o.value===3]])]),default:_(()=>[m("div",F,[g(m("div",G,[e[1]||(e[1]=m("div",{class:"tip-dot"},null,-1)),m("div",q,k(i.second),1)],512),[[y,o.value===2]]),g(m("div",J,"loading...",512),[[y,o.value===0]]),m("video",{class:"camera-player",ref_key:"video",ref:a},null,512)])]),_:1},8,["visible"]))}}),Q=M(K,[["__scopeId","data-v-a3364030"]]);function X(){const c=w([]),n=w([]);return{items:c,selected:n,onAddItem:async()=>{const r=await new Promise(d=>{const e=p(Q,{resolve:d}),f=document.createElement("div");O(e,f);const b=e.el;document.body.appendChild(b)}),l=URL.createObjectURL(r),s=await R.getVideoObject(l),t={id:R.getId(),url:l,name:"录像"+new Date().getTime(),size:z.formatSize(r.size),type:"mp4",dpi:{width:s.videoWidth,height:s.videoHeight},file:r,duration:parseInt(s.duration*10+"")/10,lastModified:A().format("YYYY-MM-DD HH:mm:ss")};c.value.push(t)},onRemoveItems:async o=>{const r=c.value.filter(({id:t})=>o.includes(t)).map(({name:t})=>t);if(!await E(r))return;const s=$(c.value,({id:t})=>o.includes(t));$(n.value,t=>o.includes(t)),P.success(`成功移除 ${s.length} 个视频`)},onConvertItems:async()=>{const o=c.value.filter(({id:r})=>n.value.includes(r));await W("video",o)}}}const Z={class:"image-info"},ee=["src"],te={class:"info-base"},ae={class:"info-name"},oe={class:"info-size"},se=I({__name:"profile",props:{data:{}},setup(c){const n=c,v=()=>{H(n.data.url)};return(a,i)=>(S(),T("div",Z,[m("video",{fit:"cover",src:a.data.url,width:50,height:34,onClick:v},null,8,ee),m("div",te,[m("div",ae,k(a.data.name),1),m("div",oe,k(a.data.size),1)])]))}}),ne=M(se,[["__scopeId","data-v-5ee3ae74"]]),ie={class:"page"},re=I({__name:"index",setup(c){const{selected:n,items:v,onAddItem:a,onRemoveItems:i,onConvertItems:o}=X(),r=j(()=>[{text:"摄像头录制",type:"primary",onClick:()=>a()},{text:"批量删除",type:"primary",disabled:n.value.length<=0,onClick:()=>i(n.value)},{text:"转化选择项",type:"primary",disabled:n.value.length<=0,onClick:()=>o()}]),l=[{title:"基础信息",dataIndex:"name",width:400,render:({record:s})=>p(ne,{data:s},null)},{title:"视频分辨率",dataIndex:"dpi",align:"center",render:({record:s})=>`${s.dpi.width} * ${s.dpi.height}`},{title:"视频时长(秒)",dataIndex:"duration",align:"center"},{title:"视频类型",dataIndex:"type",align:"center"},{title:"最后编辑时间",dataIndex:"lastModified",align:"center"}];return(s,t)=>(S(),T("div",ie,[p(u(Y),{selected:u(n),"onUpdate:selected":t[0]||(t[0]=d=>L(n)?n.value=d:null),options:{rowSelection:{type:"radio"}},data:u(v),operates:r.value,columns:l},null,8,["selected","data","operates"])]))}}),Ie=M(re,[["__scopeId","data-v-e307e129"]]);export{Ie as default};
